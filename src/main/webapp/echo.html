<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>WebSockets Echo</title>
</head>
<body>
<form id="simpleForm" >
	<input type="text" id="inputmessage"  size="50" placeholder="type something and press ENTER!"/>
</form>
<div id="messages"></div>

<script type="text/javascript">
	document.getElementById('simpleForm').addEventListener('submit', submit, false);	
	function submit(event) {
		event.preventDefault();
		send();
	}

	var websocket = null;
    doWebSocket();
	
	function send() {
		var txt = document.getElementById('inputmessage').value;
		document.getElementById('inputmessage').value='';

		doWebSocket(txt);
	}
	
	function doWebSocket(payload) {
		if ( websocket === null ) {
			websocket = new WebSocket("ws://" + window.document.location.host + '/websocket/EchoEndpoint');
			
			websocket.onerror = function(event) {
				document.getElementById('messages').innerHTML += 'Error: ' + event.data + '<br />';
			}
			
			websocket.onopen = function(event) {
				document.getElementById('messages').innerHTML += 'Connection established<br />';
				if ( payload ) {
					websocket.send(payload);
			    }
			}
			
			websocket.onclose = function(event) {
				websocket = null;
				document.getElementById('messages').innerHTML += 'Connection closed: ' + event.code + '<br />';
			}
			
			websocket.onmessage = function(event) {
				document.getElementById('messages').innerHTML += event.data + '<br />';
			}
		} else if ( payload ) {
			websocket.send(payload);
		}
		
		return websocket;
	}
	
</script>

</body>
</html>